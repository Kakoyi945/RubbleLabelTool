(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["image-list"],{"056a":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"image-list"},[t._m(0),e("el-container",{staticClass:"main"},[e("div",{staticClass:"wrap"},[e("div",{staticClass:"main-header"},[e("div",{staticClass:"header-left"},[e("span",{staticClass:"current-address"},[t._v("当前位置：")]),e("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[e("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t._v("首页")]),e("el-breadcrumb-item",[t._v(t._s(t.folderName))])],1)],1),e("div",{staticClass:"header-right"},[t.isShowAction?e("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"small",loading:t.uploadLoading},on:{click:function(e){t.dialogVisible=!0}}},[t._v("上传图片")]):t._e(),e("el-button",{attrs:{type:"success",size:"small",disabled:t.multipleSelection.length<=0,loading:t.downLoading},on:{click:t.download}},[t._v("下载")])],1)]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],ref:"multipleTable",staticClass:"m-table",attrs:{data:t.tableData,"cell-class-name":"background-table","row-class-name":"background-table","header-row-class-name":"background-table","header-cell-class-name":"background-table","element-loading-background":"rgba(0, 0, 0, 0)",fit:""},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",align:"center"}}),e("el-table-column",{attrs:{prop:"filename",label:"文件名","min-width":"300",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"template-file"},[e("div",{staticClass:"icon"},[e("svg-icon",{attrs:{"icon-class":"image"}})],1),e("span",[t._v(t._s(i.row.filename))])])]}}])}),e("el-table-column",{attrs:{prop:"type",label:"类型",width:"160"}}),e("el-table-column",{attrs:{prop:"size",label:"大小",width:"160",sortable:""}}),e("el-table-column",{attrs:{prop:"editTime",label:"修改日期",width:"160",sortable:""}}),e("el-table-column",{attrs:{align:"center",label:"操作",width:"250"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"template-operation"},[t.isShowAction?e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.markClick(i.row.img_id)}}},[t._v("标注")]):t._e(),t.isShowAction?e("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.editClick(i.row.img_id)}}},[t._v("编辑")]):t._e(),e("el-popover",{ref:i.row.img_id,attrs:{placement:"top",width:"180"}},[e("p",[t._v("确定删除本条数据吗？")]),e("div",{staticStyle:{"text-align":"right",margin:"0"}},[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.$refs[i.row.img_id].doClose()}}},[t._v("取消")]),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.deleteClick(i)}}},[t._v("确定 ")])],1),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"danger",size:"small"},slot:"reference"},[t._v("删除")])],1)],1)]}}])})],1),e("div",{staticClass:"main-bottom"},[t.tableListTotal>0?e("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,50,100,500],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.tableListTotal},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e()],1)],1)]),e("el-dialog",{attrs:{title:"上传图片",visible:t.dialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"dialog-main"},[e("el-upload",{ref:"upload",staticClass:"upload",attrs:{drag:"",action:"","auto-upload":!1,accept:"image/jpeg, image/png",multiple:"","on-change":t.uploadChange,"on-remove":t.onRemove,"http-request":t.uploadFile,"before-upload":t.beforeUpload}},[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),e("em",[t._v("点击上传")])]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过10M")])]),t.showProgress?e("div",{staticClass:"process"},[e("div",{staticClass:"process-title"},[t._v("当前进度")]),e("el-progress",{attrs:{"stroke-width":10,percentage:t.percentage,format:t.processFormat}})],1):t._e(),t.errorImageList.length>0?e("div",{staticClass:"error-image"},[e("div",{staticClass:"error-title"},[t._v("上传失败")]),t._l(t.errorImageList,(function(i,a){return e("div",{key:i,staticClass:"item-image"},[e("i",{staticClass:"error-icon el-icon-document"}),t._v(t._s(i)+" ")])}))],2):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){return t.handleClose()}}},[t._v("取 消")]),e("el-button",{attrs:{loading:t.uploadLoading,type:"primary"},on:{click:t.dialogSure}},[t._v("确 定")])],1)])],1)},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header"},[e("span",{staticClass:"title"},[t._v("海冰标注")])])}],l=(i("14d9"),i("2400")),o={name:"ImageList",data(){return{folderName:"",uploadLoading:!1,downLoading:!1,listQuery:{page:1,limit:10,img_mode:""},tableData:[],tableListTotal:0,tableLoading:!1,multipleSelection:[],dialogVisible:!1,currentProcess:0,totalProcess:0,percentage:0,showProgress:!1,startUpload:!1,errorImageList:[]}},components:{},watch:{},computed:{isShowAction(){return this.listQuery.img_mode<=1}},created(){},mounted(){this.initial()},methods:{initial(){this.folderName=this.$route.query.folderName||"",this.listQuery.img_mode=this.$route.query.folderId||"",this.getImageList()},getImageList(){this.tableLoading=!0,Object(l["e"])(this.listQuery).then(t=>{let e=t.data.list;e.forEach((t,e)=>{t.editTime=this.$GF.time.parseTime(t.editTime),t.size<1024&&t.size>=0?t.size=t.size+"B":t.size<1048576&&t.size>=1024?t.size=(t.size/1024).toFixed(2)+"KB":t.size=(t.size/1024/1024).toFixed(2)+"M"}),this.tableData=e,this.tableListTotal=t.data.totalCount,this.tableLoading=!1}).catch(t=>{this.tableLoading=!1})},handleClose(){this.dialogVisible=!1,this.showProgress=!1,this.errorImageList=[],this.$refs.upload.clearFiles()},dialogSure(){this.$refs.upload.submit()},uploadChange(t,e){this.totalProcess=e.length},onRemove(t,e){this.totalProcess=e.length},beforeUpload(t){const e=t.size/1024/1024<10;if(!e)return this.$GF.el_ui.showMessage.call(this,"文件不能超过10M","warning"),!1},uploadFile(t){this.errorImageList=[],this.showProgress=!0,this.startUpload=!0,this.uploadLoading=!0;let e=new FormData;e.append("image",t.file),e.append("img_mode",this.listQuery.img_mode),Object(l["g"])(e).then(e=>{200==e.state?this.startUpload&&(this.currentProcess++,this.percentage=this.currentProcess/this.totalProcess*100,this.currentProcess>=this.totalProcess&&(this.showProgress=!1,this.$GF.el_ui.showMessage.call(this,"上传完成","success"),this.getImageList(),this.$refs.upload.clearFiles())):this.errorImageList.push(t.file.name),this.uploadLoading=!1}).catch(e=>{this.errorImageList.push(t.file.name),this.uploadLoading=!1})},processFormat(t){return`${this.currentProcess}/${this.totalProcess}`},download(){this.downLoading=!0;let t={img_mode:this.listQuery.img_mode,img_id:""},e=this.multipleSelection.length;this.multipleSelection.forEach((i,a)=>{t.img_id+=a==e-1?i.img_id:i.img_id+","}),Object(l["c"])(t).then(t=>{200==t.state&&t.data&&(window.location.href="http://10.249.181.179:8080/"+t.data),this.downLoading=!1}).catch(t=>{this.downLoading=!1})},markClick(t){this.$router.push({path:"/mark/"+t})},editClick(t){this.$router.push({path:"/edit/"+t})},deleteClick(t){let e={img_mode:this.listQuery.img_mode,img_id:t.row.img_id};Object(l["a"])(e).then(e=>{200==e.state&&(this.$GF.el_ui.showMessage.call(this,"删除成功","success"),this.$refs[t.row.img_id].doClose(),this.$delete(this.tableData,t.$index),this.getImageList())})},handleSelectionChange(t){this.multipleSelection=t},handleSizeChange(t){this.listQuery.limit=t,this.getImageList()},handleCurrentChange(t){this.listQuery.page=t,this.getImageList()}}},r=o,n=(i("8471"),i("2877")),c=Object(n["a"])(r,a,s,!1,null,"0b4803fd",null);e["default"]=c.exports},8471:function(t,e,i){"use strict";i("c5db")},c5db:function(t,e,i){}}]);